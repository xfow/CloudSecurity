# Exploits

Most Azure exploits are around OWASP Top 10. They are particularly vulnerable to SSRF exploits, broken authentication and confidential information leakages.

Typically these vulnerabilities are found with additional modules applied to the baseline builds. This is typical in platform providers where the majority of work is done for the devs. Additional modules are added, often by third parties, and such code is often insecure and can be exploited. If you find additional modules, running typical secruity researcher exercises such as creating docker containers where analysing logs and listening on local ports is possible.

A link to a great article listing common misconfigurations found in Microsoft Azure is below, ScoutSuite should pick quite a few of these up, but there's no harm checking these issues manually.

https://www.infosecmatter.com/top-20-microsoft-azure-vulnerabilities-and-misconfigurations/

When it comes to these kinds of tests, we should approach it as we normally would when looking for exploits. What is non-standard to Azure, and are they vulnerable. As mentioned before, additional modules are often a good attack vector. It may be able to find copies of the source code online as well.

We have a few exploits below that have been reported for Microsoft Azure Services.

# Kudu/KuduLite Exploit

The Microsoft Azure administration is provided by an open source project called Kudu and the brother of this is KuduLite. These services ultimately offer administration over SSH which use hardcoded credentials for root with the password Docker. Although SSH is not usually offered externally, a SSRF exploit may allow attackers to attack the local SSH portoffered over 2222.

So we know the creds, but how are we going to attack an SSH port we can't see externally? Well the Kudu API contains a Server Side Request Forgery (SSRF) exploit we can use to attack the port. The node may send requests to the KuduLite API without access controls. Attacking VFS API usually found around /api/vfs we can ask for a path as follows and a local file inclusion will be performed, if we can forge a GET request:
 
```/ssrf_post.php?path=8.8.8.8:8181/api/vfs/site/wwwroot/```

If we can pass a POST request, command execution is possible with a payload similar to below:

```/ssrf_post.php?path=8.8.8.8:8181/command&parameter={%27command%27:%27cat%20/etc/passwd%27}```

Using the command execution, we can get a reverse shell, we know the root password is DOcker, so we can get to root. KuduLite offers a restricted shell for admin purposes, so we can get some control over the site. We can also look into common shell escape patterns, however these are common techniques outside of the scope of this document.

Here is a link to the original creator of this exploit:

https://www.intezer.com/blog/malware-analysis/kud-i-enter-your-server-new-vulnerabilities-in-microsoft-azure/


